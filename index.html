<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Keywords and Solutions Finder</title>

    <!-- Tailwind CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />

    <!-- React and ReactDOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.10/babel.min.js"></script>

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>

    <style>
      /* Additional custom styles */
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* For the scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: #c0c0c0;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #a0a0a0;
      }

      /* Loading animation */
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Root element for React application -->
    <div id="root" class="min-h-screen"></div>

    <!-- CSV Data (loaded as text) -->
    <script
      id="keywordsCSV"
      type="text/plain"
      src="csv-files/key-words-detailscsv.csv"
    ></script>
    <script
      id="solutionsCSV"
      type="text/plain"
      src="csv-files/solutions_base_template_csv.csv"
    ></script>

    <!-- Data Processing Module -->
    <script type="text/babel">
      // Data processing functions
      const DataProcessing = {
        parseCSV(file) {
          try {
            const result = Papa.parse(file, {
              header: true,
              skipEmptyLines: true,
              dynamicTyping: true,
            });
            return result.data;
          } catch (error) {
            console.error("Error parsing CSV:", error);
            return [];
          }
        },

        processKeywords(rawData) {
          return rawData.map((row, index) => ({
            id: index,
            keyWord: row["Key Word"] || "",
            solution: row["Solution"] || "",
            industryTrends: row["Industry Trends"] || "",
            keyPhrases: row["Key Words / Key Phrases"] || "",
            qualifyingQuestions: row["Qualifying/Discovery Questions"] || "",
          }));
        },

        processSolutions(rawData) {
          return rawData.map((row, index) => ({
            id: index,
            title: row["Solution Title"] || "",
            longDescription: row["Long-Description"] || "",
            shortDescription: row["Short-Description"] || "",
            trends: row["Trends"] || "",
            painPoints: row["Business Pain Points Addressed"] || "",
            verticalRelevance: row["Vertical-Specific Relevance"] || "",
            keyWords: row["Key Words"] || "",
            qualifyingQuestions: row["Qualifying Questions"] || "",
            handlingObjections: row["Handling Objections"] || "",
          }));
        },

        mapSolutionsToCategories(keywords, solutions) {
          // Extract unique solutions from keywords
          const keywordSolutions = [
            ...new Set(keywords.map((k) => k.solution).filter(Boolean)),
          ];

          // Create mapping object
          const mapping = {};

          // For each keyword solution, try to find matching main solution
          keywordSolutions.forEach((kSolution) => {
            // Check for IIM prefix and map to Intelligent Information Management
            if (kSolution.startsWith("IIM")) {
              mapping[kSolution] = "Intelligent Information Management";
              return;
            }

            // Check for print-related solutions
            if (kSolution.includes("Print") || kSolution === "MICR") {
              mapping[kSolution] = "Managed  Services"; // Note: double space in original data
              return;
            }

            // Check for security-related solutions
            if (kSolution.includes("Security")) {
              mapping[kSolution] = "Security Services";
              return;
            }

            // Check for cloud-related solutions
            if (kSolution.includes("Cloud")) {
              mapping[kSolution] = "Cloud Services";
              return;
            }

            // Check for lifecycle/device management
            if (
              kSolution.includes("Lifecycle") ||
              kSolution.includes("Device")
            ) {
              mapping[kSolution] = "Managed IT Services";
              return;
            }

            // For any other cases, try to find a partial match in solution titles
            const matchingSolution = solutions.find(
              (s) =>
                kSolution.includes(s.title) ||
                s.title.includes(kSolution) ||
                (s.keyWords &&
                  s.keyWords.toLowerCase().includes(kSolution.toLowerCase()))
            );

            if (matchingSolution) {
              mapping[kSolution] = matchingSolution.title;
            } else {
              // Default to "Other" if no match found
              mapping[kSolution] = "Other";
            }
          });

          return mapping;
        },

        searchKeywords(keywords, searchTerm) {
          if (!searchTerm) return keywords;

          const term = searchTerm.toLowerCase();
          return keywords.filter((keyword) => {
            // Search in keyword, solution, and key phrases
            return (
              keyword.keyWord.toLowerCase().includes(term) ||
              keyword.solution.toLowerCase().includes(term) ||
              keyword.keyPhrases.toLowerCase().includes(term) ||
              keyword.industryTrends.toLowerCase().includes(term) ||
              keyword.qualifyingQuestions.toLowerCase().includes(term)
            );
          });
        },

        getKeywordsForSolution(keywords, solutionTitle, solutionMapping) {
          // Get all keyword solutions that map to this main solution
          const relatedSolutions = Object.entries(solutionMapping)
            .filter(([_, mainSolution]) => mainSolution === solutionTitle)
            .map(([kSolution, _]) => kSolution);

          // Filter keywords by these solutions
          return keywords.filter((keyword) =>
            relatedSolutions.includes(keyword.solution)
          );
        },
      };

      window.DataProcessing = DataProcessing;
    </script>

    <!-- Main Application -->
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { Search } = lucide;

      // Main application component
      function KeyWordsAndSolutionsApp() {
        // State for data
        const [keywords, setKeywords] = useState([]);
        const [solutions, setSolutions] = useState([]);
        const [solutionMapping, setSolutionMapping] = useState({});
        const [isLoading, setIsLoading] = useState(true);
        const [error, setError] = useState(null);

        // State for UI
        const [searchTerm, setSearchTerm] = useState("");
        const [selectedSolutions, setSelectedSolutions] = useState([]);
        const [activeKeyword, setActiveKeyword] = useState(null);
        const [view, setView] = useState("keywords"); // 'keywords' or 'solutions'

        // Load data from CSV files
        useEffect(() => {
          const loadData = async () => {
            try {
              setIsLoading(true);

              // Fetch the keywords CSV file
              const keywordsResponse = await fetch(
                "csv-files/key-words-detailscsv.csv"
              );
              const keywordsText = await keywordsResponse.text();
              const keywordsRaw = DataProcessing.parseCSV(keywordsText);
              const processedKeywords =
                DataProcessing.processKeywords(keywordsRaw);

              // Fetch the solutions CSV file
              const solutionsResponse = await fetch(
                "csv-files/solutions_base_template_csv.csv"
              );
              const solutionsText = await solutionsResponse.text();
              const solutionsRaw = DataProcessing.parseCSV(solutionsText);
              const processedSolutions =
                DataProcessing.processSolutions(solutionsRaw);

              // Create mapping between keyword solutions and main solutions
              const mapping = DataProcessing.mapSolutionsToCategories(
                processedKeywords,
                processedSolutions
              );

              setKeywords(processedKeywords);
              setSolutions(processedSolutions);
              setSolutionMapping(mapping);
              setIsLoading(false);
            } catch (err) {
              console.error("Error loading data:", err);
              setError(
                "Failed to load data. Please check that the CSV files are accessible."
              );
              setIsLoading(false);
            }
          };

          loadData();
        }, []);

        // Filter keywords based on search term and selected solutions
        const filteredKeywords = keywords.filter((keyword) => {
          // Filter by search term
          const matchesSearch =
            searchTerm === "" ||
            keyword.keyWord.toLowerCase().includes(searchTerm.toLowerCase()) ||
            keyword.keyPhrases
              .toLowerCase()
              .includes(searchTerm.toLowerCase()) ||
            keyword.industryTrends
              .toLowerCase()
              .includes(searchTerm.toLowerCase()) ||
            keyword.qualifyingQuestions
              .toLowerCase()
              .includes(searchTerm.toLowerCase());

          // Filter by selected solutions
          const matchesSolution =
            selectedSolutions.length === 0 ||
            selectedSolutions.some((solution) => {
              // Get the main solution for this keyword
              const mainSolution = solutionMapping[keyword.solution];
              return solution === mainSolution || solution === keyword.solution;
            });

          return matchesSearch && matchesSolution;
        });

        // Handle solution selection
        const toggleSolution = (solutionTitle) => {
          setSelectedSolutions((prev) =>
            prev.includes(solutionTitle)
              ? prev.filter((s) => s !== solutionTitle)
              : [...prev, solutionTitle]
          );
        };

        // Switch between keywords and solutions view
        const toggleView = (newView) => {
          setView(newView);
          setActiveKeyword(null); // Reset active keyword when switching views
        };

        return (
          <div className="flex flex-col h-screen bg-gray-50">
            {/* Header with search */}
            <header className="bg-blue-700 text-white p-4 shadow-md">
              <div className="container mx-auto">
                <h1 className="text-2xl font-bold mb-4">
                  Keywords and Solutions Finder
                </h1>
                <div className="relative">
                  <input
                    type="text"
                    placeholder="Search for keywords..."
                    className="w-full p-2 pl-10 rounded text-gray-800"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                  />
                  <Search
                    className="absolute left-3 top-2.5 text-gray-500"
                    size={20}
                  />
                </div>
              </div>
            </header>

            {/* Main content area */}
            <div className="flex flex-1 overflow-hidden">
              {/* Sidebar */}
              <aside className="w-64 bg-white p-4 border-r border-gray-200 overflow-y-auto">
                <div className="mb-4">
                  <h2 className="text-lg font-semibold mb-2">View</h2>
                  <div className="flex space-x-2 mb-4">
                    <button
                      className={`px-3 py-1 rounded ${
                        view === "keywords"
                          ? "bg-blue-600 text-white"
                          : "bg-gray-200"
                      }`}
                      onClick={() => toggleView("keywords")}
                    >
                      Keywords
                    </button>
                    <button
                      className={`px-3 py-1 rounded ${
                        view === "solutions"
                          ? "bg-blue-600 text-white"
                          : "bg-gray-200"
                      }`}
                      onClick={() => toggleView("solutions")}
                    >
                      Solutions
                    </button>
                  </div>
                </div>

                <h2 className="text-lg font-semibold mb-2">Solutions</h2>
                {isLoading ? (
                  <p>Loading solutions...</p>
                ) : (
                  <div className="space-y-4">
                    {/* Main Solutions */}
                    <div className="space-y-2">
                      <h3 className="text-sm font-medium text-gray-700">
                        Main Solutions
                      </h3>
                      {solutions.map((solution) => (
                        <div key={solution.id} className="flex items-center">
                          <input
                            type="checkbox"
                            id={`solution-${solution.id}`}
                            checked={selectedSolutions.includes(solution.title)}
                            onChange={() => toggleSolution(solution.title)}
                            className="mr-2"
                          />
                          <label
                            htmlFor={`solution-${solution.id}`}
                            className="text-sm"
                          >
                            {solution.title}
                          </label>
                        </div>
                      ))}
                    </div>

                    {/* Keyword Solutions */}
                    <div className="space-y-2">
                      <h3 className="text-sm font-medium text-gray-700">
                        Keyword Solutions
                      </h3>
                      {Object.keys(solutionMapping).map(
                        (keywordSolution, idx) => (
                          <div
                            key={`ksolution-${idx}`}
                            className="flex items-center"
                          >
                            <input
                              type="checkbox"
                              id={`ksolution-${idx}`}
                              checked={selectedSolutions.includes(
                                keywordSolution
                              )}
                              onChange={() => toggleSolution(keywordSolution)}
                              className="mr-2"
                            />
                            <label
                              htmlFor={`ksolution-${idx}`}
                              className="text-sm"
                            >
                              {keywordSolution}
                            </label>
                          </div>
                        )
                      )}
                    </div>
                  </div>
                )}
              </aside>

              {/* Main content */}
              <main className="flex-1 p-6 overflow-y-auto">
                {isLoading ? (
                  <div className="flex justify-center items-center h-full">
                    <div className="spinner"></div>
                    <p className="ml-4 text-lg">Loading content...</p>
                  </div>
                ) : error ? (
                  <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                    <p>{error}</p>
                  </div>
                ) : view === "keywords" ? (
                  <div>
                    {activeKeyword ? (
                      <KeywordDetail
                        keyword={activeKeyword}
                        onBack={() => setActiveKeyword(null)}
                      />
                    ) : (
                      <KeywordsList
                        keywords={filteredKeywords}
                        onSelectKeyword={setActiveKeyword}
                      />
                    )}
                  </div>
                ) : (
                  <SolutionsList
                    solutions={solutions.filter(
                      (s) =>
                        selectedSolutions.length === 0 ||
                        selectedSolutions.includes(s.title)
                    )}
                  />
                )}
              </main>
            </div>
          </div>
        );
      }

      // Component for the keywords list
      function KeywordsList({ keywords, onSelectKeyword }) {
        if (keywords.length === 0) {
          return (
            <div className="text-center py-10">
              <p className="text-gray-500">
                No keywords match your search criteria.
              </p>
            </div>
          );
        }

        return (
          <div>
            <h2 className="text-xl font-semibold mb-4">
              Keywords ({keywords.length})
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {keywords.map((keyword) => (
                <div
                  key={keyword.id}
                  className="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-md transition-shadow border-l-4 border-blue-500"
                  onClick={() => onSelectKeyword(keyword)}
                >
                  <h3 className="font-semibold text-lg mb-2">
                    {keyword.keyWord}
                  </h3>
                  <p className="text-sm text-blue-600 mb-2">
                    {keyword.solution}
                  </p>
                  <p className="text-xs text-gray-500 mb-2">
                    Related to:{" "}
                    {keyword.keyPhrases.split(",").slice(0, 3).join(", ")}
                    {keyword.keyPhrases.split(",").length > 3 && "..."}
                  </p>
                  <div className="flex justify-end">
                    <span className="text-xs text-blue-500 hover:underline">
                      View details →
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        );
      }

      // Component for keyword details
      function KeywordDetail({ keyword, onBack }) {
        return (
          <div className="bg-white rounded-lg shadow-md p-6">
            <button
              onClick={onBack}
              className="mb-4 px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors flex items-center"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                className="h-4 w-4 mr-1"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fillRule="evenodd"
                  d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z"
                  clipRule="evenodd"
                />
              </svg>
              Back to Keywords
            </button>

            <div className="border-l-4 border-blue-500 pl-4 mb-6">
              <h2 className="text-2xl font-bold mb-2">{keyword.keyWord}</h2>
              <p className="text-blue-600 mb-1">Solution: {keyword.solution}</p>
            </div>

            <div className="space-y-6">
              <section className="bg-gray-50 p-4 rounded-lg">
                <h3 className="text-lg font-semibold mb-2 text-blue-700">
                  Industry Trends
                </h3>
                <div className="text-gray-700 whitespace-pre-line">
                  {keyword.industryTrends || "No industry trends available"}
                </div>
              </section>

              <section className="bg-gray-50 p-4 rounded-lg">
                <h3 className="text-lg font-semibold mb-2 text-blue-700">
                  Key Words / Key Phrases
                </h3>
                <div className="flex flex-wrap gap-2">
                  {keyword.keyPhrases ? (
                    keyword.keyPhrases.split(",").map((phrase, i) => (
                      <span
                        key={i}
                        className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm"
                      >
                        {phrase.trim()}
                      </span>
                    ))
                  ) : (
                    <p className="text-gray-500">No key phrases available</p>
                  )}
                </div>
              </section>

              <section className="bg-gray-50 p-4 rounded-lg">
                <h3 className="text-lg font-semibold mb-2 text-blue-700">
                  Qualifying/Discovery Questions
                </h3>
                <div className="text-gray-700">
                  {keyword.qualifyingQuestions ? (
                    <ul className="space-y-2">
                      {keyword.qualifyingQuestions
                        .split("\n\n")
                        .filter(Boolean)
                        .map((question, i) => (
                          <li
                            key={i}
                            className="bg-white p-3 rounded border-l-2 border-blue-300"
                          >
                            {question}
                          </li>
                        ))}
                    </ul>
                  ) : (
                    <p className="text-gray-500">
                      No qualifying questions available
                    </p>
                  )}
                </div>
              </section>
            </div>
          </div>
        );
      }

      // Component for solutions list
      function SolutionsList({ solutions }) {
        if (solutions.length === 0) {
          return (
            <div className="text-center py-10">
              <p className="text-gray-500">
                No solutions selected. Please select at least one solution from
                the sidebar.
              </p>
            </div>
          );
        }

        return (
          <div className="space-y-8">
            <h2 className="text-xl font-semibold mb-4">
              Solutions ({solutions.length})
            </h2>

            {solutions.map((solution) => (
              <div
                key={solution.id}
                className="bg-white rounded-lg shadow-md overflow-hidden"
              >
                {/* Solution header */}
                <div className="bg-blue-600 text-white p-4">
                  <h3 className="text-xl font-bold">{solution.title}</h3>
                  <p className="mt-1 text-blue-100">
                    {solution.shortDescription}
                  </p>
                </div>

                {/* Solution details */}
                <div className="p-6 space-y-6">
                  <section>
                    <h4 className="text-lg font-semibold mb-2 text-blue-700">
                      Description
                    </h4>
                    <p className="text-gray-700 whitespace-pre-line">
                      {solution.longDescription}
                    </p>
                  </section>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <section className="bg-gray-50 p-4 rounded-lg">
                      <h4 className="text-lg font-semibold mb-3 text-blue-700">
                        Trends
                      </h4>
                      <div className="text-gray-700">
                        {solution.trends ? (
                          <ul className="space-y-2">
                            {solution.trends
                              .split("\n")
                              .filter(Boolean)
                              .map((trend, i) => (
                                <li key={i} className="flex items-start">
                                  <svg
                                    className="h-5 w-5 text-blue-500 mr-2 mt-0.5"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                  >
                                    <path
                                      strokeLinecap="round"
                                      strokeLinejoin="round"
                                      strokeWidth="2"
                                      d="M9 5l7 7-7 7"
                                    />
                                  </svg>
                                  <span>{trend}</span>
                                </li>
                              ))}
                          </ul>
                        ) : (
                          <p className="text-gray-500">No trends available</p>
                        )}
                      </div>
                    </section>

                    <section className="bg-gray-50 p-4 rounded-lg">
                      <h4 className="text-lg font-semibold mb-3 text-blue-700">
                        Business Pain Points Addressed
                      </h4>
                      <div className="text-gray-700">
                        {solution.painPoints ? (
                          <ul className="space-y-2">
                            {solution.painPoints
                              .split("\n")
                              .filter(Boolean)
                              .map((point, i) => (
                                <li key={i} className="flex items-start">
                                  <svg
                                    className="h-5 w-5 text-red-500 mr-2 mt-0.5"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                  >
                                    <path
                                      strokeLinecap="round"
                                      strokeLinejoin="round"
                                      strokeWidth="2"
                                      d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"
                                    />
                                  </svg>
                                  <span>{point}</span>
                                </li>
                              ))}
                          </ul>
                        ) : (
                          <p className="text-gray-500">
                            No pain points available
                          </p>
                        )}
                      </div>
                    </section>
                  </div>

                  <section className="bg-gray-50 p-4 rounded-lg">
                    <h4 className="text-lg font-semibold mb-2 text-blue-700">
                      Vertical-Specific Relevance
                    </h4>
                    <div className="text-gray-700 whitespace-pre-line">
                      {solution.verticalRelevance ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {solution.verticalRelevance
                            .split("\n")
                            .filter(Boolean)
                            .map((vertical, i) => {
                              const [industry, description] =
                                vertical.split(":");
                              return (
                                <div
                                  key={i}
                                  className="bg-white p-3 rounded border-l-2 border-blue-400"
                                >
                                  {industry && description ? (
                                    <>
                                      <strong className="text-blue-800">
                                        {industry.trim()}:
                                      </strong>
                                      <span>{description.trim()}</span>
                                    </>
                                  ) : (
                                    <span>{vertical}</span>
                                  )}
                                </div>
                              );
                            })}
                        </div>
                      ) : (
                        <p className="text-gray-500">
                          No vertical-specific relevance available
                        </p>
                      )}
                    </div>
                  </section>

                  {solution.qualifyingQuestions && (
                    <section className="bg-gray-50 p-4 rounded-lg">
                      <h4 className="text-lg font-semibold mb-2 text-blue-700">
                        Qualifying Questions
                      </h4>
                      <div className="text-gray-700">
                        <ul className="space-y-2">
                          {solution.qualifyingQuestions
                            .split(";")
                            .filter(Boolean)
                            .map((question, i) => (
                              <li
                                key={i}
                                className="bg-white p-3 rounded border-l-2 border-green-400"
                              >
                                {question.trim()}
                              </li>
                            ))}
                        </ul>
                      </div>
                    </section>
                  )}
                </div>
              </div>
            ))}
          </div>
        );
      }

      // Render the application
      ReactDOM.render(
        <KeyWordsAndSolutionsApp />,
        document.getElementById("root")
      );
    </script>
  </body>
</html>
