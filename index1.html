<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Keywords Finder</title>

    <!-- Tailwind CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />

    <!-- React and ReactDOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.10/babel.min.js"></script>

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
      /* Loading animation */
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Sidebar styling */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          left: -256px;
          z-index: 50;
          transition: left 0.3s ease;
        }

        .sidebar.open {
          left: 0;
        }

        .overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.5);
          z-index: 40;
        }

        .overlay.open {
          display: block;
        }

        .sidebar-toggle {
          display: block !important;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // Enhanced app component
      function App() {
        const [keywords, setKeywords] = useState([]);
        const [uniqueSolutions, setUniqueSolutions] = useState([]);
        const [isLoading, setIsLoading] = useState(true);
        const [error, setError] = useState(null);
        const [activeKeyword, setActiveKeyword] = useState(null);
        const [selectedSolutions, setSelectedSolutions] = useState([]);
        const [activeSolution, setActiveSolution] = useState(null);
        const [searchTerm, setSearchTerm] = useState("");
        const [sidebarOpen, setSidebarOpen] = useState(false);

        // Load keywords from CSV
        useEffect(() => {
          async function loadData() {
            try {
              setIsLoading(true);

              const response = await fetch(
                "./csv-files/key-words-detailscsv.csv"
              );
              if (!response.ok) {
                throw new Error(`CSV file not found: ${response.status}`);
              }

              const csvText = await response.text();
              console.log("CSV loaded, length:", csvText.length);

              const result = Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
              });

              const processedData = result.data.map((row, index) => ({
                id: index,
                keyWord: row["Key Word"] || "",
                solution: row["Solution"] || "",
                industryTrends: row["Industry Trends"] || "",
                keyPhrases: row["Key Words / Key Phrases"] || "",
                qualifyingQuestions:
                  row["Qualifying/Discovery Questions"] || "",
              }));

              // Extract unique solutions
              const solutions = [
                ...new Set(
                  processedData.map((k) => k.solution).filter(Boolean)
                ),
              ];

              setKeywords(processedData);
              setUniqueSolutions(solutions);
              console.log("Loaded", processedData.length, "keywords");
              console.log("Found", solutions.length, "unique solutions");
              setIsLoading(false);
            } catch (err) {
              console.error("Error loading data:", err);
              setError(err.message);
              setIsLoading(false);
            }
          }

          loadData();
        }, []);

        // Filter keywords based on search and selected solutions
        const filteredKeywords = keywords.filter((keyword) => {
          // Search filter
          const matchesSearch =
            !searchTerm ||
            (keyword.keyWord &&
              keyword.keyWord
                .toLowerCase()
                .includes(searchTerm.toLowerCase())) ||
            (keyword.solution &&
              keyword.solution
                .toLowerCase()
                .includes(searchTerm.toLowerCase())) ||
            (keyword.keyPhrases &&
              keyword.keyPhrases
                .toLowerCase()
                .includes(searchTerm.toLowerCase())) ||
            (keyword.industryTrends &&
              keyword.industryTrends
                .toLowerCase()
                .includes(searchTerm.toLowerCase()));

          // Solution filter
          const matchesSolution =
            selectedSolutions.length === 0 ||
            selectedSolutions.includes(keyword.solution);

          return matchesSearch && matchesSolution;
        });

        // Handle solution selection
        const toggleSolution = (solution) => {
          setSelectedSolutions((prev) => {
            if (prev.includes(solution)) {
              // If already selected, unselect it
              const newSelected = prev.filter((s) => s !== solution);
              // If we're unselecting the active solution, clear it
              if (activeSolution === solution) {
                setActiveSolution(null);
              }
              return newSelected;
            } else {
              // Select the solution and make it active
              setActiveSolution(solution);
              return [...prev, solution];
            }
          });
        };

        // Toggle sidebar on mobile
        const toggleSidebar = () => {
          setSidebarOpen((prev) => !prev);
        };

        // Select all solutions
        const selectAllSolutions = () => {
          setSelectedSolutions([...uniqueSolutions]);
          setActiveSolution(null);
        };

        // Clear all solutions
        const clearAllSolutions = () => {
          setSelectedSolutions([]);
          setActiveSolution(null);
        };

        // Show keyword details
        function KeywordDetails({ keyword, onBack }) {
          return (
            <div className="bg-white p-6 rounded-lg shadow-md">
              <button
                onClick={onBack}
                className="mb-4 px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 flex items-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  className="h-4 w-4 mr-1"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fillRule="evenodd"
                    d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z"
                    clipRule="evenodd"
                  />
                </svg>
                Back to Keywords
              </button>

              <div className="border-l-4 border-blue-500 pl-4 mb-4">
                <h2 className="text-2xl font-bold">
                  Solution: {keyword.solution}
                </h2>
                <p className="text-blue-600">{keyword.keyWord}</p>
              </div>

              <div className="space-y-4">
                <section className="bg-gray-50 p-4 rounded">
                  <h3 className="text-lg font-semibold mb-2 text-blue-700">
                    Industry Trends
                  </h3>
                  <p className="text-gray-700 whitespace-pre-line">
                    {keyword.industryTrends || "No trends available"}
                  </p>
                </section>

                <section className="bg-gray-50 p-4 rounded">
                  <h3 className="text-lg font-semibold mb-2 text-blue-700">
                    Key Phrases
                  </h3>
                  <div className="flex flex-wrap gap-2">
                    {keyword.keyPhrases ? (
                      keyword.keyPhrases.split(",").map((phrase, i) => (
                        <span
                          key={i}
                          className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm"
                        >
                          {phrase.trim()}
                        </span>
                      ))
                    ) : (
                      <p>No key phrases available</p>
                    )}
                  </div>
                </section>

                <section className="bg-gray-50 p-4 rounded">
                  <h3 className="text-lg font-semibold mb-2 text-blue-700">
                    Qualifying Questions
                  </h3>
                  <div>
                    {keyword.qualifyingQuestions ? (
                      <div className="space-y-2">
                        {keyword.qualifyingQuestions
                          .split("\n\n")
                          .filter(Boolean)
                          .map((q, i) => (
                            <div
                              key={i}
                              className="bg-white p-3 border-l-2 border-blue-300 rounded"
                            >
                              {q}
                            </div>
                          ))}
                      </div>
                    ) : (
                      <p>No qualifying questions available</p>
                    )}
                  </div>
                </section>
              </div>
            </div>
          );
        }

        // Show solution details
        function SolutionDetails({ solution, keywords, onBack }) {
          // Get the first keyword for this solution
          const firstKeyword = keywords.length > 0 ? keywords[0] : null;

          if (!firstKeyword) {
            return (
              <div className="text-center py-10">
                <button
                  onClick={onBack}
                  className="mb-4 px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 flex items-center"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-4 w-4 mr-1"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fillRule="evenodd"
                      d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z"
                      clipRule="evenodd"
                    />
                  </svg>
                  Back to Keywords
                </button>
                <p className="text-gray-500">
                  No keywords found for this solution.
                </p>
              </div>
            );
          }

          // Process and deduplicate data
          // Collect unique industry trends
          const uniqueTrends = [
            ...new Set(keywords.map((k) => k.industryTrends).filter(Boolean)),
          ];

          // Collect all key phrases (already using Set for uniqueness)
          const allKeyPhrases = new Set();
          keywords.forEach((keyword) => {
            if (keyword.keyPhrases) {
              keyword.keyPhrases.split(",").forEach((phrase) => {
                allKeyPhrases.add(phrase.trim());
              });
            }
          });

          // Process qualifying questions to avoid repetition
          // Extract all individual questions and deduplicate
          const individualQuestions = new Set();
          keywords.forEach((keyword) => {
            if (keyword.qualifyingQuestions) {
              keyword.qualifyingQuestions
                .split("\n\n")
                .filter(Boolean)
                .forEach((question) => {
                  individualQuestions.add(question.trim());
                });
            }
          });

          return (
            <div className="bg-white p-6 rounded-lg shadow-md">
              <button
                onClick={onBack}
                className="mb-4 px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 flex items-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  className="h-4 w-4 mr-1"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fillRule="evenodd"
                    d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z"
                    clipRule="evenodd"
                  />
                </svg>
                Back to Keywords
              </button>

              <div className="border-l-4 border-blue-500 pl-4 mb-4">
                <h2 className="text-2xl font-bold">Solution: {solution}</h2>
                <p className="text-blue-600">{firstKeyword.keyWord}</p>
              </div>

              <div className="space-y-4">
                <section className="bg-gray-50 p-4 rounded">
                  <h3 className="text-lg font-semibold mb-2 text-blue-700">
                    Industry Trends
                  </h3>
                  <div className="text-gray-700">
                    {uniqueTrends.length > 0 ? (
                      <div className="space-y-2">
                        {uniqueTrends.map((trend, i) => (
                          <p key={i} className="whitespace-pre-line">
                            {trend}
                          </p>
                        ))}
                      </div>
                    ) : (
                      <p>No industry trends available</p>
                    )}
                  </div>
                </section>

                <section className="bg-gray-50 p-4 rounded">
                  <h3 className="text-lg font-semibold mb-2 text-blue-700">
                    Key Phrases
                  </h3>
                  <div className="flex flex-wrap gap-2">
                    {allKeyPhrases.size > 0 ? (
                      Array.from(allKeyPhrases).map((phrase, i) => (
                        <span
                          key={i}
                          className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm"
                        >
                          {phrase}
                        </span>
                      ))
                    ) : (
                      <p>No key phrases available</p>
                    )}
                  </div>
                </section>

                <section className="bg-gray-50 p-4 rounded">
                  <h3 className="text-lg font-semibold mb-2 text-blue-700">
                    Qualifying Questions
                  </h3>
                  <div>
                    {individualQuestions.size > 0 ? (
                      <div className="space-y-2">
                        {Array.from(individualQuestions).map((question, i) => (
                          <div
                            key={i}
                            className="bg-white p-3 border-l-2 border-blue-300 rounded"
                          >
                            {question}
                          </div>
                        ))}
                      </div>
                    ) : (
                      <p>No qualifying questions available</p>
                    )}
                  </div>
                </section>

                <section className="mt-6">
                  <h3 className="text-lg font-semibold mb-2">
                    All Keywords for {solution}
                  </h3>
                  <div className="flex flex-wrap gap-2">
                    {keywords.map((kw) => (
                      <span
                        key={kw.id}
                        className="bg-white text-gray-800 font-semibold py-1 px-3 border border-gray-300 rounded-full text-sm"
                      >
                        {kw.keyWord}
                      </span>
                    ))}
                  </div>
                </section>
              </div>
            </div>
          );
        }

        // Main view
        if (isLoading) {
          return (
            <div className="flex justify-center items-center h-screen">
              <div className="spinner"></div>
              <p className="ml-4">Loading keywords...</p>
            </div>
          );
        }

        if (error) {
          return (
            <div className="max-w-2xl mx-auto mt-10 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
              <h2 className="text-lg font-bold mb-2">Error Loading Data</h2>
              <p>{error}</p>
              <p className="mt-2 text-sm">
                Make sure the CSV file exists at:{" "}
                <code>./csv-files/key-words-detailscsv.csv</code>
              </p>
            </div>
          );
        }

        return (
          <div className="flex flex-col min-h-screen">
            {/* Header */}
            <header className="bg-blue-700 text-white p-4">
              <div className="container mx-auto flex items-center">
                <button
                  className="sidebar-toggle mr-3 p-1 rounded hover:bg-blue-600 focus:outline-none hidden"
                  onClick={toggleSidebar}
                >
                  <svg
                    className="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth="2"
                      d="M4 6h16M4 12h16M4 18h16"
                    ></path>
                  </svg>
                </button>

                <h1 className="text-2xl font-bold">Keywords Finder</h1>
              </div>

              <div className="container mx-auto mt-3">
                <div className="relative">
                  <input
                    type="text"
                    placeholder="Search keywords..."
                    className="w-full p-2 pl-10 rounded text-gray-800"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                  />
                  <svg
                    className="absolute left-3 top-3 text-gray-500"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  >
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                  </svg>
                </div>
              </div>
            </header>

            {/* Mobile overlay */}
            <div
              className={`overlay ${sidebarOpen ? "open" : ""}`}
              onClick={() => setSidebarOpen(false)}
            ></div>

            {/* Main content */}
            <div className="flex flex-1 overflow-hidden">
              {/* Sidebar */}
              <aside
                className={`sidebar bg-white w-64 p-4 border-r border-gray-200 overflow-y-auto ${
                  sidebarOpen ? "open" : ""
                }`}
              >
                <div className="mb-4">
                  <h2 className="text-lg font-semibold mb-2">
                    Filter by Solutions
                  </h2>
                  <div className="flex space-x-2 mb-3">
                    <button
                      className="px-3 py-1 bg-blue-600 text-white rounded text-sm"
                      onClick={selectAllSolutions}
                    >
                      Select All
                    </button>
                    <button
                      className="px-3 py-1 bg-gray-200 rounded text-sm"
                      onClick={clearAllSolutions}
                    >
                      Clear All
                    </button>
                  </div>
                </div>

                <div className="space-y-2">
                  {uniqueSolutions.map((solution, index) => (
                    <div key={index} className="flex items-center">
                      <input
                        type="checkbox"
                        id={`solution-${index}`}
                        checked={selectedSolutions.includes(solution)}
                        onChange={() => toggleSolution(solution)}
                        className="mr-2"
                      />
                      <label htmlFor={`solution-${index}`} className="text-sm">
                        {solution}
                      </label>
                    </div>
                  ))}
                </div>
              </aside>

              {/* Main content area */}
              <main className="flex-1 p-6 overflow-y-auto">
                {activeKeyword ? (
                  <KeywordDetails
                    keyword={activeKeyword}
                    onBack={() => setActiveKeyword(null)}
                  />
                ) : activeSolution ? (
                  <SolutionDetails
                    solution={activeSolution}
                    keywords={keywords.filter(
                      (k) => k.solution === activeSolution
                    )}
                    onBack={() => setActiveSolution(null)}
                  />
                ) : (
                  <div>
                    <h2 className="text-xl font-semibold mb-4">
                      Keywords ({filteredKeywords.length})
                    </h2>

                    {/* Only display the pills, nothing else */}
                    <div className="flex flex-wrap gap-3">
                      {filteredKeywords.map((keyword) => (
                        <button
                          key={keyword.id}
                          className="bg-white hover:bg-blue-50 text-gray-800 font-semibold py-2 px-4 border border-gray-300 rounded-full shadow-sm"
                          onClick={() => setActiveKeyword(keyword)}
                        >
                          {keyword.keyWord}
                        </button>
                      ))}
                    </div>

                    {filteredKeywords.length === 0 && (
                      <div className="text-center py-10 text-gray-500">
                        No keywords match your search criteria
                      </div>
                    )}
                  </div>
                )}
              </main>
            </div>
          </div>
        );
      }

      // Render the app
      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
